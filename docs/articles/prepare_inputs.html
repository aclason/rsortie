<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsortie">
<title>Preparing inputs for rsortie • rsortie</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparing inputs for rsortie">
<meta property="og:description" content="rsortie">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsortie</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preparing inputs for rsortie</h1>
            
            <h4 data-toc-skip class="date">January 2022</h4>
      
      
      <div class="d-none name"><code>prepare_inputs.Rmd</code></div>
    </div>

    
    
<p>This vignettes describes the files required to run rsortie for SORTIE parameter file editing and creating new files.</p>
<div class="section level2">
<h2 id="inputs-to-prepare">
<strong>Inputs to prepare:</strong><a class="anchor" aria-label="anchor" href="#inputs-to-prepare"></a>
</h2>
<ul>
<li>Base SORTIE parameter file</li>
<li>list of files to update</li>
<li>values to substitute those in the base parameter file and/or</li>
<li>.xml chunks to substitute with those in the base parameter file.</li>
</ul>
<div class="section level3">
<h3 id="base-sortie-parameter-file-xml">
<strong>Base SORTIE parameter file (xml)</strong><a class="anchor" aria-label="anchor" href="#base-sortie-parameter-file-xml"></a>
</h3>
<p>To set up a base parameter file and run SORTIE, you must already have access to a parameter file - SORTIE comes with an example parameter file called GMF.xml that can be used to learn.</p>
<div class="section level4">
<h4 id="behaviours">Behaviours<a class="anchor" aria-label="anchor" href="#behaviours"></a>
</h4>
<p>rsortie interacts with SORTIE parameter files. These are .xmls that contain the list of variables within behaviours defined in the SORTIE GUI. rsortie cannot interact with or change elements that do not exist already in the base xml file, so it is important to understand the GUI to select all the behaviours required to run a SORTIE simulation. Importantly, if you intend to primarily use rsortie to assign values to variables within the selected behaviours, you must assign a non-zero value to those variables, or those lines do not get printed to the base xml.</p>
<p><strong>All the behaviours, including harvests or plantings, that you want to interact with in rsortie must be contained within the base file.</strong></p>
<p>This is related to how the .xml is saved from SORTIE (only behaviours selected are included in the xml), and each behaviour is assigned a list position. If you add or remove a behaviour in the SORTIE GUI, these list positions will be automatically updated in the resulting xml, but we don’t yet have that capability to adjust behaviour list positions in rsortie, and it may not be possible. Any of the behaviours can be populated with dummy variables (1s) and harvest or planting areas (just select some cells in the harvest and planting interfaces), as these can all be substituted in an rsortie run. As long as they exist in the base xml file, often with a non-zero value required, all variables within behaviours can be changed in rsortie.</p>
</div>
</div>
<div class="section level3">
<h3 id="tree-population">Tree population<a class="anchor" aria-label="anchor" href="#tree-population"></a>
</h3>
<p>The base SORTIE parameter file must contain the species, and diameter size classes required to set up an initial tree population. These changes must be done in the SORTIE GUI using Edit &gt; Tree Population &gt; Edit species list, and/or Edit initial density size classes:</p>
<p><img src="TreeSizeClasses.jpg" alt="Output Setup"> You can use rsortie to remove an entire species from a base SORTIE parameter file, but you cannot add a species in rsortie. So again, set up the base file in the GUI to contain all the species that might be used in a run.</p>
<p>A common mistake is to leave 0s in all the tree species-diameter size classes for the initial stand conditions, but 0s will result in that species-diameter class not being available in the actual saved base parameter file xml. Populate each of these with a 1 in the base parameter file, and then they will be available for substitution by zeros or non-zeros using makeFiles in rsortie.</p>
<div class="figure">
<img src="TreeInits.jpg" alt=""><p class="caption">Output Setup</p>
</div>
<p>We typically also select the options required for outputs in the base SORTIE parameter file in the SORTIE GUI. Select outputs from the edit menu:</p>
<p><img src="OutputBox.jpg" alt="Output Setup"> Select the information that will be added as columns from each tree:</p>
<p><img src="OutputTreeOptions.jpg" alt="Output Setup"> And which grids to track:</p>
<p><img src="OutputGridOptions.jpg" alt="Output Setup"> For more information on these output options and the behaviours that create them, please visit <a href="http://sortie-nd.org/help/manuals/index.html" class="external-link uri">http://sortie-nd.org/help/manuals/index.html</a>.</p>
</div>
<div class="section level3">
<h3 id="a-list-of-files">
<strong>A List of files</strong><a class="anchor" aria-label="anchor" href="#a-list-of-files"></a>
</h3>
<p>To use rsortie to substitute variable values or chunks of .xml in a SORTIE parameter file requires a list of files passed to the makeFiles function. This list of files can be stored as a .csv in a folder outside of R, or it can be created in R and passed as an object to the makeFiles function.</p>
<p>There are six different slots allowed in this table of files, with a minimum of two types required. The column names must be: Type and Description.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Type</th>
<th align="left">Description</th>
<th align="center">Required</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="left">Base parameter file</td>
<td align="center">Yes</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="left">New values file</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="center">2-5</td>
<td align="left">New values file</td>
<td align="center">No</td>
</tr>
</tbody>
</table>
<p>There can be more than one of any of the file types. The code will loop through all combinations of the all the files. The resulting xml files will be named with a combination of each of the names present: type0-type1-type2.xml.</p>
<p>Example:</p>
<p>type, name<br>
0, Test.xml<br>
1, t1.csv<br>
2, f2.xml<br>
2, g2.csv<br>
3, p3.csv<br>
3, r3.csv</p>
<p>The resulting output files will be named: test-t1-f2-p3.xml, test-t1-f2-r3.xml, test-t1-g2-p3.xml, test-t1-g2-r3.xml.</p>
</div>
<div class="section level3">
<h3 id="variablenames">
<strong>VariableNames</strong><a class="anchor" aria-label="anchor" href="#variablenames"></a>
</h3>
<p>This a translation file that matches the parameter names in the input file with those in the base parameter file, with the type of variable critical for successful substition of variable values. rsortie comes with a default VariableNames data.frame, that can be updated in R with new rows by users, or a user can pass their own VariableNames data.frame and override the default in the makeFiles function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aclason.github.io/rsortie/">rsortie</a></span><span class="op">)</span>
<span class="op">?</span><span class="va">makeFiles</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">VariableNames</span><span class="op">)</span>
<span class="co">#&gt;   InputFileParameterName Type        code.name group.name</span>
<span class="co">#&gt; 1              Timesteps    1        timesteps           </span>
<span class="co">#&gt; 2             Randomseed    1       randomSeed           </span>
<span class="co">#&gt; 3       YearsPerTimestep    1 yearsPerTimestep           </span>
<span class="co">#&gt; 4            rt_timestep    1      rt_timestep           </span>
<span class="co">#&gt; 5             randomSeed    1       randomSeed           </span>
<span class="co">#&gt; 6       yearsPerTimestep    1 yearsPerTimestep</span></code></pre></div>
<div class="section level4">
<h4 id="editing-variablenames">Editing VariableNames<a class="anchor" aria-label="anchor" href="#editing-variablenames"></a>
</h4>
<p>The VariableNames file contains two important pieces of information: (1) mapping the variable name in the input new values file(s) to the corresponding base parameter file variable name, and (2) the type of the variable in the xml file. <strong>You must be familiar with the SORTIE base parameter file</strong> because this file contains the names that rsortie will use to identify what to change.</p>
<p>If making your own VariableNames data.frame, column headings must be:</p>
<pre><code> *col 1: InputFileParameterName
 *col 2: Type
 *col 3: code.name
 *col 4: group.name</code></pre>
<div class="section level5">
<h5 id="variablenames-input-file-parameter-name">
<em>VariableNames: Input file Parameter Name</em><a class="anchor" aria-label="anchor" href="#variablenames-input-file-parameter-name"></a>
</h5>
<p>The input file parameter names specify the names of the variables as contained in the “new values file(s)”. In other words, these are the names assigned by users to whichever variables are intended for substition. These can be the unique names assigned to tree size classes (Initial_Density_4cm), or the names of a variable within a behaviour (Max_Growth_NCI).</p>
<p><strong>The names in the first column of the VariableNames data.frame can be anything you want, but they must match <em>exactly</em> the naming convention in the new values files</strong></p>
</div>
<div class="section level5">
<h5 id="variablenames-type">
<em>VariableNames: Type</em><a class="anchor" aria-label="anchor" href="#variablenames-type"></a>
</h5>
<p>The base parameter file contains many different formats for its behaviours and variables. Some behaviours are simple with the variable name and its value on the same line. Some include species, and some are grouped in a more complex xml hierarchy structure. Some are completely uniquely named, but many require first identifying the location of the correct behaviour and then finding the appropriate variable name within that behaviour. The Type column in the VariableNames file is critical to identify the format of the variable and thus the rules in the code for finding and replacing the right variable. So far, 7 different formats have been identified and coded:</p>
<ol style="list-style-type: decimal">
<li>= basic case: variable parameter is directly after the name</li>
<li>= basic case with species: same, but with a species name after it</li>
<li>= behaviorlist type: but basic parameter - similar to 1</li>
<li>= behaviorlist type: but with species - similar to 2</li>
<li>= output files: so parameter file will have a directory name</li>
<li>= groups with species on the previous line, e.g. for initial density</li>
<li>=</li>
<li>= behaviourlist type: similar to 4, but no subgroup, because of unique tag</li>
</ol>
<p><em>Variable Types: <span style="color: blue;">Blue text</span> is an example from the base parameter file (the SORTIE-generated file). <span style="color: green;">Green text</span> is an example from the VariableNames file and <span style="color: purple;">purple text</span> is the example from the parameter value file (the csv file).</em></p>
<p>Type 1: the value is on the same line and directly after the variable name:<br><span style="color: blue;">&lt;timesteps&gt;20&lt;/timesteps&gt;</span><br><span style="color: green;">Timesteps,1,timesteps,</span><br><span style="color: purple;">Timesteps,66,66,66,66</span></p>
<p>Type 7: Disturbance types (e.g. Episodic Mortality). This is like the Behaviour types. In the new values file, the disturbance type goes on one line and then the variable name and values for each species on the following line. The VariableNames file just requires the names and type. You would use this type to update species-specific parameter values (i.e. amount of lodgepole pine to harvest), as opposed to replacing the harvest layout with an xml chunk.</p>
<p>Type 8: the value is within a behaviour list (similar to 4), but no subgroup <plant12><gr_nmpgval species="Interior_Spruce">4.0152016</gr_nmpgval></plant12></p>
<p>The current version of the VariableNames file is not exhaustive. It only contains those variables that were being used in the testing files. However, new variables that fit one of the 7 currently defined types should be able to be added and the code should run.</p>
</div>
<div class="section level5">
<h5 id="variablenames-code-name-and-group-name">
<em>VariableNames: code.name and group.name</em><a class="anchor" aria-label="anchor" href="#variablenames-code-name-and-group-name"></a>
</h5>
<p>To find variable names in the base parameter file associated with a behaviour, open the base parameter file and locate the behaviour of interest. Depending on the behaviour, there will be at least one but sometimes two names required to include in the VariableNames file: code.name is always required, and group.name sometimes.</p>
<p>First look at the base parameter file in an xml viewer like internet explorer:</p>
<div class="figure">
<img src="NCI_behaviourScreenShot.jpg" alt=""><p class="caption">Looking for variable names in a base parameter file</p>
</div>
<p>Compare this structure to that found in the VariableNames file:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VariableNames</span><span class="op">[</span><span class="fl">20</span><span class="op">:</span><span class="fl">40</span>,<span class="op">]</span></code></pre></div>
<p>This example illustrates that the variable code.name is always adjacent to the value that is going to be updated, while the variable group.name is required when there’s a grouping variable name.</p>
<p>In summary, to add a new variable to the VariableNames file:</p>
<ol style="list-style-type: decimal">
<li>Find the line in the base parameter file that contains the right information.</li>
<li>See which of the current 7 types fit.</li>
<li>Make a note of the relevant variable name(s) as written in the base parameter file. The species name is not important, but the Behaviour List name or the group name may be important.</li>
<li>Look at the new values file and determine or assign the corresponding <em>input file variable name</em>.</li>
<li>Edit the VariableNames file to add the variable name (step 4), type (step 2), base parameter file variable name(s) (step 3). Note that the order of the lines in the VariableNames file does not matter, so this new line may be added at any point in the file.</li>
<li>Comments may be added to the VariableNames file by prefacing the line with “!”.</li>
</ol>
<p><strong>All strings in VariableNames are completely case and space sensitive; the code is looking for exact matches. For example, use Timesteps not TimeSteps or timesteps or Time steps.</strong></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="new-values-files">
<strong>New values files</strong><a class="anchor" aria-label="anchor" href="#new-values-files"></a>
</h3>
<p>There are two types of new values files: csv and xml</p>
<p>In all cases, variables are updated in the base parameter file in the order that they are in the new values file, and in the order of the slot of list of files passed to makeFiles. New value files are read from top to bottom, and file slots from the list of files are addressed from 1 to 3. So, a variable that is in slot 3 will supersede one that is in a slot 1 file. This could be useful if you wish, for example, to replace an xml section (e.g. as a slot 2 file), but then change one of its parameters (e.g., in a slot 3 file).</p>
<div class="section level4">
<h4 id="csv-files">
<strong>CSV files</strong><a class="anchor" aria-label="anchor" href="#csv-files"></a>
</h4>
<p>These files contain a set of new values for different variables</p>
<ul>
<li>The first row must be a blank column and then the species names as in the xml file. As with variable names it is critical that the species names are exactly the same as they are in the xml file and the code searches for an exact match.<br>
</li>
<li>The second line must be “na” if the values proceeding are Types 1 or 2 (no associated behaviour), or the name of Behaviour to which the variables following it apply. The Behavoiur name comes from the base parameter file, so requires knowledge of the xml file and its naming. It is also necessary to give the list name because there could be multiple behavior lists with the same set of variable names. The behaviour name must also have the behaviour list position number attached to it (e.g. logisticgrowth7, competitivemortality9) - again, this will be found in the base parameter file</li>
</ul>
<p><strong>Adding or remove a behaviour during the development of the base parameter file, be sure to track the behaviour list position of any variables that might be substituted using rsortie</strong></p>
<ul>
<li><p>When the variables for the behavior are finished, if there are variables from different behaviours, or switching to variables without behaviours (e.g. timesteps or output directory), you need to mark the start of the new section with either the next Behaviour name (with list position number) or “na” if no behaviour.</p></li>
<li><p>If the variable has values for each species, the code looks for a variable in the corresponding column. If the variable is not species specific (e.g. timestep), then only the first column is used. <em>Values can be in the other columns, they will just be ignored.</em></p></li>
<li><p>The code will create output file names for each new parameter xml file and append this output parameter file name to the given output directory.</p></li>
</ul>
<p><strong>The new values file should always include the directory into which the output should be placed.</strong></p>
<ul>
<li>The format of the output directory pathway must include a final “” and will look something like:”Output,C:\Projects\SORTIE\test\” for the detailed output, and “ShortOutput,C:\Projects\SORTIE\test\” for the summary output.</li>
<li>The output file name will be a combination of the base parameter file name and the new values file name, which is also the file name used for the new parameter file. Note that the file extension on the Output file will be _det.gz.tar and on the ShortOutput fill be .out. For example, a new parameter file: base-123.xml, detailed output file: base-123_det.gz.tar, and summary output file: base-123.out.</li>
</ul>
<p><strong>If output file directory paths are not provided in the new values file, SORTIE may fail to run as the output directory in the base parameter file may not exist on the local computer</strong></p>
</div>
<div class="section level4">
<h4 id="xml-files">
<strong>XML files</strong><a class="anchor" aria-label="anchor" href="#xml-files"></a>
</h4>
<p>The second type of new values file enables the replacement or deletion of xml code. The tool replaces the existing lines of text with the new lines of text from the file or delete a section of code. The file must contain complete xml format code.</p>
<ul>
<li>
<strong>Substitute all variables from a behavior:</strong> The file can contain a completely new set of variables contained within a behaviour, such as allometry or GapDispersal21. The tool will look at the first line of the new values file, determine what to look for, and replace all the lines between the beginning and end of the section with the new code. For example, you could use this to completely replace the allometry section of the input file. This is frequently used in replacing a harvest placeholder in the base parameter file with the entended harvest design<br>
</li>
<li>
<strong>Delete an xml section:</strong> Put the name of the section that you wish to delete in the first line of the xml file (e.g. StochasticMortality9). The second line of the file must contain -999. The tool will then find the section that corresponds to what is in the first line of the file, and then remove it entirely from the final xml file. For example:<br>
&lt;StochasticMortality9&gt;<br>
&lt;delete&gt;-999&lt;/delete&gt;<br>
&lt;/StochasticMortality9&gt;</li>
</ul>
<p>The makeFiles function in rsortie will search through the new values xml file, replacing one section at a time, in order. Any number of xml sections can be present in this file, and the file can include both sections to delete or sections to replace.</p>
<p><em>Deleting behaviours through a new values xml file as part of the makeFiles function requires further testing</em></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sarah Beukema, Alana Clason.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
